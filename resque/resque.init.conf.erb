description "Resque worker configuration. Run with ID"

start on (local-filesystems and net-device-up IFACE=eth0)
stop on shutdown

respawn
respawn limit 5 20

script
  PIDFILE=/www/lexim/shared/pids/resque.pid
  COUNT=4
  QUEUE=*
  echo $$ > $PIDFILE
  chown lexim:lexim $PIDFILE
  exec su -c "cd /www/lexim/current && einhorn -n $COUNT /usr/local/bin/ruby -S bundle exec rake QUEUE=* RAILS_ENV=production PIDFILE=$PIDFILE resque:work >> /www/lexim/shared/log/resque.log 2>&1" lexim
end script